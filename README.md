# Задание для  Школы бэкенд-разработки 2022 (лето)

<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Задание-для--Школы-бэкенд-разработки-2022-(лето)" data-toc-modified-id="Задание-для--Школы-бэкенд-разработки-2022-(лето)-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Задание для  Школы бэкенд-разработки 2022 (лето)</a></span><ul class="toc-item"><li><span><a href="#Описание-задания" data-toc-modified-id="Описание-задания-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Описание задания</a></span></li><li><span><a href="#Технические-требования" data-toc-modified-id="Технические-требования-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Технические требования</a></span></li></ul></li><li><span><a href="#Реализация" data-toc-modified-id="Реализация-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Реализация</a></span><ul class="toc-item"><li><span><a href="#Команды-запуска-по-SSH-на-выделенной-машине" data-toc-modified-id="Команды-запуска-по-SSH-на-выделенной-машине-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>Команды запуска по SSH на выделенной машине</a></span></li><li><span><a href="#Установка-сервиса-на-рабочем-компьютере" data-toc-modified-id="Установка-сервиса-на-рабочем-компьютере-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>Установка сервиса на рабочем компьютере</a></span><ul class="toc-item"><li><span><a href="#Тестирование" data-toc-modified-id="Тестирование-2.2.1"><span class="toc-item-num">2.2.1&nbsp;&nbsp;</span>Тестирование</a></span></li></ul></li></ul></li></ul></div>

## Описание задания ##

В данном задании предлагается реализовать бэкенд для веб-сервиса сравнения цен, аналогичный сервису [Яндекс Товары](https://yandex.ru/products). Обычно взаимодействие с такими сервисами происходит следующим образом:
1. Представители магазинов загружают информацию о своих товарах и категориях. Также можно изменять и удалять информацию о ранее загруженных товарах и категориях.
2. Покупатели, пользуясь веб-приложением, могут искать предложения разных магазинов, сравнивать цены и следить за их динамикой и историей.

Задача - разработать REST API сервис, который позволяет магазинам загружать и обновлять информацию о товарах, а пользователям - смотреть какие товары были обновлены за последние сутки, а также следить за динамикой цен товара или категории за указанный интервал времени.

## Технические требования ##

Реализуйте сервис на Python или Java в зависимости от выбранного направления школы. Сервис должен удовлетворять следующим требованиям:
- реализует спецификацию API, описанную в файле <code>openapi.yaml</code>, и корректно отвечает на запросы проверяющей системы
- некоторые обработчики из них являются необязательными, их реализация позволит вам набрать дополнительное количество баллов
- сервис должен быть развернут в контейнере на `0.0.0.0:80`
- сервис должен обеспечивать персистентность данных (должен сохранять состояние данных при перезапуске)
- сервис должен обладать возможностью автоматического перезапуска при рестарте контейнера, в котором работает ваш бэкенд (этого можно достичь настройкой контейнера)
- после запуска сервиса время ответа сервиса на все методы API не должно превышать 1 секунду
- время полного старта сервиса не должно превышать 1 минуту
- импорт и удаление данных не превосходит 1000 элементов в 1 минуту
- RPS (Request per second) получения  статистики, недавних изменений и информации об элементе суммарно не превосходит 100 запросов в секунду

# Реализация

В качестве основы проекта использовался Generate Server редактора [SwaggerEdition](https://editor.swagger.io/). Генерация кода была проведена по заданной спецификации API, описанной в файле openapi.yaml  по варианту Python-Flask.
Полученный код дополнен REST API сервисом, который позволяет магазинам загружать и обновлять информацию о товарах, а пользователям - смотреть какие товары были обновлены за последние сутки, а также следить за динамикой цен товара или категории за указанный интервал времени.

Реализованы обработчики

- Базовые задачи
- -  /imports:           Импортирует новые товары и/или категории.
- -  /delete/{id}:       Удалить элемент по идентификатору
- -  /nodes/{id}:        Получить информацию об элементе по идентификатору.
  
- Дополнительные задачи        
- -  /sales:                Получение списка **товаров**, цена которых была обновлена за последние 24 часа включительно
        
- -  /node/{id}/statistic:  Получение статистики (истории обновлений) по товару/категории за заданный полуинтервал 

Исходный код загружен на предоставленную машину в директорию swagger_server со входом по SSH.
Дополнительные файлы

- Dockerfile       - dockerfile
- requirements.txt - требования к установке пакетов
- unit_test.py     - официальный минитест
- openapi.yaml     - спецификации API

- Для инициализации [tox](https://tox.wiki/en/latest/example/basic.html)

        setup.py
        test-requirements.txt
        tox.ini


## Команды запуска по SSH на выделенной машине

**создание образа flask_docker**

    sudo docker image build -t flask_docker .
    
**развертывание сервиса в контейнере на `0.0.0.0:80`**

    sudo docker run -d -p 80:80 --restart always flask_docker  
        
ключи 

-    -p - обеспечивает подключение к порту 80
-    --restart - реализует автоматический перезапуск при рестарте контейнера

Персистентность данных обеспечивается путем их сохранения в директории data на анонимном томе.
Информацию о томах можно получить с помощью команды

    sudo docker volume ls


## Установка сервиса на рабочем компьютере


**установка пакетов - как рекомендует swagger server**

    pip install -r requirements.txt

**запуск сервиса**

    python -m swagger_server
    
**для запуска интеграционных тестов нужно использовать  tox**

    pip install tox
    tox    

### Тестирование ###

- тестирование сервиса на рабочем компьютере

    python3  unit_test.py
    
    
- тестирование сервиса, запущенного по адресу http://10.21.2.68/

    python3  unit_test.py  http://10.21.2.68/  
# Task1
# Task1
